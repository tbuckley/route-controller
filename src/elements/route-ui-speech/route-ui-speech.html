<!--
/**
 * @module Route UI Elements
 */
/**
 * route-ui-speech
 *
 * Example:
 *
 *     <route-ui-speech></route-ui-speech>
 *
 * @class route-ui-speech
 */
-->
<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../../components/polymer-flex-layout/polymer-flex-layout.html">
<link rel="import" href="../route-ui-tile/route-ui-tile.html">

<polymer-element name="route-ui-speech" attributes="messenger">
  <template>
    <link rel="stylesheet" href="route-ui-speech.css">

    <route-ui-tile id="tile" on-route-ui-tile-tap="{{centerHandler}}">

      <div style="height: 100%">
        <polymer-flex-layout vertical></polymer-flex-layout>

        <div flex></div>
        <div style="width: 128px; height: 128px; margin: auto;position: relative;">
          <div class="icon">
            <polymer-flex-layout vertical></polymer-flex-layout>
            <div flex></div>
            <div class="name">Voice</div>
            <div flex></div>
          </div>
        </div>
        <div flex></div>
      </div>

    </route-ui-tile>

  </template>
  <script>
    Polymer('route-ui-speech', {
      ready: function() {
        if(!window.plugins || !window.plugins.speechrecognizer) {
          this.$.tile.classList.add("disabled");
        }
      },
      centerHandler: function() {
        if(window.plugins && window.plugins.speechrecognizer) {
          this.$.tile.classList.add("active");

          var maxMatches = 1;
          var promptString = "What can I do for you?"; // optional
          var language = "en-US";         // optional
          window.plugins.speechrecognizer.startRecognize(this.resultHandler.bind(this),
            this.errorHandler.bind(this), maxMatches, promptString, language);
        }
      },
      resultHandler: function(result) {
        this.$.tile.classList.remove("active");
        this.messenger.send("Voice", {
          result: result,
        });
      },
      errorHandler: function(e) {
        console.log(error);
        this.$.tile.classList.remove("active");
      },
    });
  </script>
</polymer-element>