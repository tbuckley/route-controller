<!--
/**
 * @module Route UI Elements
 */
/**
 * route-ui-media
 *
 * Example:
 *
 *     <route-ui-media messenger="{{messenger}}"></route-ui-media>
 *
 * @class route-ui-media
 */
-->
<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../route-ui-tile/route-ui-tile.html">
<link rel="import" href="../polymer-image-search/polymer-image-search.html">
<link rel="import" href="../route-state/route-state.html">

<polymer-element name="route-ui-media" attributes="messenger">
  <template>
    <link rel="stylesheet" href="route-ui-media.css">

    <route-state name="Sonos.Main.TrackInfo" on-state-change="{{trackChanged}}"></route-state>
    <polymer-image-search id="imageSearch" query="{{query}}" on-load="{{loadHandler}}"></polymer-image-search>

    <route-ui-tile id="tile" on-route-ui-tile-left="{{nextTrack}}" on-route-ui-tile-right="{{prevTrack}}"
        on-route-ui-tile-center="{{playPause}}">
      <div class="album-name">{{name}}</div>
      <div id="artwork">
    </route-ui-tile>

  </template>
  <script>
    Polymer('route-ui-media', {
      trackChanged: function(event, details, sender) {
        this.name = details.name;
        this.query = details.artist + " " + details.album + " album art";
      },
      playPause: function() {
        this.messenger.emit("DeviceEvent", "PlayPause", {});
      },
      nextTrack: function() {
        this.messenger.emit("DeviceEvent", "NextTrack", {});
      },
      prevTrack: function() {
        this.messenger.emit("DeviceEvent", "PrevTrack", {});
      },
      loadHandler: function(error, img, sender) {
        while(this.$.artwork.hasChildNodes()) {
          this.$.artwork.removeChild(this.$.artwork.lastChild);
        }
        this.$.artwork.appendChild(img);

        var dim = this.offsetWidth - 8;
        if(img.width > img.height) {
          var width = (dim * img.width / img.height),
              offset = -Math.floor((width - dim) / 2);

          img.style.position = "relative";
          img.style.height = dim + "px";
          img.style.width = "auto";
          img.style.left = offset + "px";
        } else {
          var height = (dim * img.height / img.width),
              offset = -Math.floor((height - dim) / 2);

          img.style.position = "relative";
          img.style.width = dim + "px";
          img.style.height = "auto";
          img.style.top = offset + "px";
        }
      },
    });
  </script>
</polymer-element>