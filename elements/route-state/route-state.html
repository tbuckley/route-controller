<!--
/**
 * @module Route Elements
 */
/**
 * route-state
 *
 * Example:
 *
 *     <route-state name="Sonos.CurrentTrack" value="{{current}}"></route-state>
 *
 * @class route-state
 */
-->
<link rel="import" href="../../components/polymer/polymer.html">
<link rel="import" href="../route-socket/route-socket.html">

<polymer-element name="route-state" attributes="name value">
  <template>
    <route-socket id="socket"></route-socket>
  </template>
  <script>
    Polymer('route-state', {
      name: null,
      value: null,
      attached: function() {
        this.handler = this.stateHandler.bind(this);
        this.$.socket.on('state', this.handler);
      },
      detached: function() {
        this.$.socket.removeListener('state', this.handler);
      },
      nameChanged: function(oldName, newName) {
        console.log("NAME CHANGED: ", oldName, newName, this.name);
      },
      stateHandler: function(data) {
        console.log("STATE: ", data);
        var parts = this.name.split('.');
        for(var i = 0; i < parts.length; i++) {
          if(parts[i] in data) {
            data = data[parts[i]];
          } else {
            return;
          }
        }
        this.value = data;
        this.fire("state-change", data);
      },
    });
  </script>
</polymer-element>